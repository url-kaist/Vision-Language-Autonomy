<launch>
  <!-- OctoMap 서버: 해상도 및 센서 최대거리 -->
  <node pkg="octomap_server" type="octomap_server_node" name="octomap_server" output="screen">
    <param name="resolution"          value="0.1"/>
    <param name="sensor_model/max_range" value="5.0"/>
    <param name="frame_id"            type="string" value="map"/>
    <param name="base_frame_id"       type="string" value="baselink"/>
    <param name="occupancy/meanUpdate" value="false"/>
    <param name="publish_free_space" value="true"/>  
    <param name="publish_occupied_nodes" value="true"/>
    <param name="minimum_occupancy" value="80"/>   
    <!-- 로봇 높이를 고려해, 너무 낮은 z 축 지점 무시 -->
    <param name="minimum_z"         value="0.05"/>  
    <param name="maximum_z"         value="1.2"/>  
    <!-- 경사 허용 범위 조정(지면 외부 역노이즈 억제) -->
    <param name="max_slope_ugv"     value="0.3"/>   
    <remap from="cloud_in" to="/sensor_scan"/>
  </node>

  <!-- 3D→2D 맵 변환: 지면 & 슬로프 파라미터 -->
  <node pkg="mapconversion" type="map_conversion_oct_node" name="map_conversion" output="screen">
    <remap from="octomap" to="octomap_binary"/>
    <!-- 바닥 노이즈 제거: 10cm 이하 무시 -->
    <param name="minimum_z"             value="0.2"/>
    <!-- 최소 관측 횟수: 3~5회 -->
    <param name="minimum_occupancy"     value="50"/>
    <param name="map_frame"             value="map"/>
    <!-- UGV 주행 불가 경사: 0.3rad (≈17°) 이상 -->
    <param name="max_slope_ugv"         value="0.1"/>
    <!-- 경사 산출 윈도우 크기: 3 -->
    <param name="slope_estimation_size" value="1.5"/>
  </node>
</launch>
